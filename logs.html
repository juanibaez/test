<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>8th Sensus.</title>

    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link href="./font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="./css/animate.css" rel="stylesheet">
    <link href="./css/style.css" rel="stylesheet">
    <link href="./css/plugins/select2/select2.min.css" rel="stylesheet">
    <link href="./css/plugins/datapicker/datepicker3.css" rel="stylesheet">
    <link href="./css/plugins/dataTables/datatables.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.10.22/css/jquery.dataTables.min.css" rel="stylesheet">
</head>

<body class="top-navigation">

    <div id="wrapper">
        <div id="page-wrapper" class="gray-bg">
<!--MENU-->
        <div class="row border-bottom white-bg">
        <nav class="navbar navbar-expand-lg navbar-static-top" role="navigation">
            <a href="#" class="navbar-brand"><img src="./img/logo1.png"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-label="Toggle navigation">
                <i class="fa fa-reorder"></i>
            </button>
            <!--ITEMS-->
            <div class="navbar-collapse collapse" id="navbar">
                <ul class="nav navbar-nav mr-auto">
                    <li> <a aria-expanded="false" href="./index.html"> Home</a></li>
                    <li> <a aria-expanded="false" href="./productivity.html">  Productivity (TBD)</a></li>
                    <li class="active"> <a aria-expanded="false" href="./logs.html"> Logs</a></li>
                    <li> <a aria-expanded="false" href="./licenses.html"> Licenses</a></li>

                </ul>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <a href="login.html">
                            <i class="fa fa-sign-out"></i> Log out
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        </div>
<!--CONTAINER-->

            <div class="wrapper wrapper-content">
                <!--PICKERS-->
                <div class="ibox-content">
                    <div class="table-responsive">
                        <div id="example_wrapper" class="dataTables_wrapper container-fluid dt-bootstrap4">
                            <table id="example" class="display dataTable table-striped">
                                <thead>
                                <tr role="row">
                                    <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="User ID: activate to sort column ascending">User ID</th>
                                    <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="Machine Name: activate to sort column ascending">Machine Name</th>
                                    <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="MAC Address: activate to sort column ascending">MAC Address</th>
                                    <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="Remote IP Address: activate to sort column ascending">Remote IP Address</th>
                                    <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="Local IP Address: activate to sort column ascending">Local IP Address</th>
                                    <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="GPS: activate to sort column ascending">GPS</th>
                                    <th class="sorting" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-label="Events: activate to sort column ascending">Events</th>
                                    <th class="sorting_desc" tabindex="0" aria-controls="example" rowspan="1" colspan="1" aria-sort="descending" aria-label="Date/Time: activate to sort column ascending">Date/Time</th>
                                </tr>
                                </thead>
                        </table>
                        </div>
                    </div>
                </div>
                <!--LIST SAMPLE-->

            </div>
<!--FOOTER-->
        <div class="footer">
            <div>
                <strong>Copyright</strong> Sample 8th Sensus 2021.
            </div>
        </div>
        </div>
    </div>
    <!-- Mainly scripts -->
    <script src="./js/jquery-3.1.1.min.js"></script>
    <script src="./js/popper.min.js"></script>
    <script src="./js/bootstrap.js"></script>
    <script src="./js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="./js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    <!-- Custom and plugin javascript -->
    <script src="./js/inspinia.js"></script>
    <script src="./js/plugins/pace/pace.min.js"></script>
    <script src="./js/multislider.js"></script>
    <!-- Flot -->
    <script src="./js/plugins/flot/jquery.flot.js"></script>
    <script src="./js/plugins/flot/jquery.flot.tooltip.min.js"></script>
    <script src="./js/plugins/flot/jquery.flot.resize.js"></script>
    <script src="./js/plugins/flot/jquery.flot.pie.js"></script>
    <script src="./js/plugins/flot/jquery.flot.time.js"></script>
    <!-- ChartJS-->
    <script src="./js/plugins/chartJs/Chart.min.js"></script>
    <script src="./js/demo/chartjs-pro.js"></script>
    <!-- Peity -->
    <script src="./js/plugins/peity/jquery.peity.min.js"></script>
    <!-- Peity demo -->
    <script src="./js/demo/peity-demo.js"></script>
    <!-- Selector -->
    <script src="./js/plugins/select2/select2.full.min.js"></script>
    <!-- Data picker -->
    <script src="./js/plugins/datapicker/bootstrap-datepicker.js"></script>
    <!-- Table -->
    <script src="./plugin/js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="./plugin/js/plugins/dataTables/datatables.min.js"></script>
    <script src="./plugin/js/plugins/dataTables/dataTables.bootstrap4.min.js"></script>
</body>
<script>
        let dataSet = null;

        $.ajax({
            url: 'https://dashboard.8thsensus.com:8080/message',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            type: "GET", /* or type:"GET" or type:"PUT" */
            dataType: "json",
            contentType: 'application/json',
            data: {
            },

            success: function (result) {
                var matrix = result.length;

                var table = $('#example').DataTable({
                data: result,
                columns: [
                    { data: "userid" },
                    { data: "machinename" },
                    { data: "mac" },
                    { data: "remoteip" },
                    { data: "localip" },
                    { data: "gps" },
                    { data: "diagcode" },
                    { data: "stamp" },
                    { data: "key" },
                ],

                columnDefs: [
                    {
                        "targets": [ 8 ],
                        "visible": false,
                        "searchable": false
                    }
                ],

                order: [[ 8, "desc" ]],

                rowCallback: function(row, data, index){
                    if("data['key'] != 'valid key'") {
                        $(row).find('td:eq(0)').css('color', 'red');
                    }
                },

                rowCallback: function(row, data, index){
                    $(row).find('td:eq(6)').html(getCode(data['diagcode']));
                },

                /**
                rowCallback: function(row, data, index){
                    //var confifence = data['confidence']
                    $(row).find('td:eq(7)').html('<center><button class="btn btn-primary  btn-circle" type="button"><i class="fa fa-arrow-up"></i></button></center>');
                    /**
                        var confifence = confifence.replace('{', '');
                        confifence = confifence.replace('}', '');
                        if ((confifence.toFixed(1) >= 1.0) && (confifence.toFixed(1) <= .8)) {
                            $(row).find('td:eq(7)').html('<center><button class="btn btn-primary  btn-circle" type="button"><i class="fa fa-arrow-up"></i></button></center>');
                        }
                        if ((confifence.toFixed(1) > .8) && (confifence.toFixed(1) <= .4)) {
                            $(row).find('td:eq(7)').html('<center><button class="btn btn-warning  btn-circle" type="button"><i class="fa fa-arrow-right"></i></button></center>');
                        }
                        if ((confifence.toFixed(1) > .4) && (confifence.toFixed(1) <= 0.0)) {
                            $(row).find('td:eq(7)').html('<center><button class="btn btn-danger btn-circle" type="button"><i class="fa fa-arrow-down"></i></button></center>');
                        }


                },
                **/
                select: true,
                pageLength: 25,
                responsive: true,
                dom: '<"html5buttons"B>lTfgitp',
                buttons: [
                    { extend: 'copy' },
                    { extend: 'csv' },
                    { extend: 'excel', title: 'ExampleFile' },
                    { extend: 'pdf', title: 'ExampleFile' },

                    {
                        extend: 'print',
                        customize: function (win) {
                            $(win.document.body).addClass('white-bg');
                            $(win.document.body).css('font-size', '10px');

                            $(win.document.body).find('table')
                                .addClass('compact')
                                .css('font-size', 'inherit');
                        }
                    }
                ]
            });
            $("#example tr").css('cursor', 'hand');
            //setInterval( function () {
            //    table.ajax.reload();
                //alert("sadsasda")
            //}, 3000 );

            /*$('#example tbody').on('click', 'tr', function () {
                var data = table.row(this).data().userid;
                url = "devices/?usrid=" + data;
                window.location.replace(url);
            } );*/

            },
            error: function (request, status, error) {
                //alert("Response: " + error);
            }
        })

        function getCode(code) {
            var codeDiscription = "";
            var codeJson = [{
                "D0001": "Screen Unlocked | Initial Login after reboot | Confidence 1:5,000,000",
                "D0002": "Screen Unlocked | Zero Touch Unlocked authorized user |  1:5,000,000",
                "D0003": "Screen Locked 0 | Zero Touch Locked no user present | Confidence 1:5,000,000",
                "D0004": "Screen Locked 2 | Manual Lock Initiated by authorized user |  1:5,000,000",
                "D0005": "Screen Locked 1| Lock without Camera | Confidence 1:5,000,000",
                "D0006": "Screen Unlocked | Authorized user certified | Confidence 1:25,000,000",
                "D0007": "Screen Locked 2 | Manual Lock Initiated by authorized user | Manual Process",
                "D0008": "Screen Unlocked | Unauthorized user(s) presented |  Confidence 1:5,000,000",
                "D0009": "Screen Locked 1 | Unauthorized user(s) presented  | Confidence 1:5,000,000",
                "D0010": "Screen Unlocked | Authorized user(s) presented | 1:5,000,000",
                "D0011": "Screen Unlocked | Unauthorized user(s) presented | Confidence 1:100,000",
                "D0012": "Screen Locked 3 | Power Savings Lock Initiated | System Process",
                "D0013": "Screen Unlocked | 8th Sensus EVE Stopped | Error",
                "D0014": "Screen Unlocked | Video Conference in progress| Confidence 1:5,000,000",
                "D0015": "Screen Locked 1 | Over the Shoulder unauthorized user(s) presented |  > 1"
            }];

            $.each(codeJson[0], function(key, value){
                if (code == key) {
                    codeDiscription = value;
                }
            });
            return codeDiscription
        }

    </script>
</html>
